<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STRIKE FORGE - Tactical Overview</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a2e0e6f0b3.js" crossorigin="anonymous"></script>
</head>
<body>
  <div class="header">
    <div class="logo">
      <i class="fa-solid fa-gamepad"></i>
      <h1>STRIKE FORGE - Tactical Overview</h1>
    </div>
    <div class="search-bar">
      <input type="text" placeholder="Cari ID, atau Nama">
      <i class="fa-solid fa-magnifying-glass"></i>
    </div>
  </div>

  <div style="display: flex; gap: 20px; margin-top: 20px;">
    <div class="sidebar">
      <button id="btn-dashboard">Dashboard</button>
      <button>Inventaris Utama</button>
      <hr style="border: 1px solid #3a3a3a; margin: 15px 0;">
      <button class="btn-gray" id="btn-logout">Log Out</button>
    </div>

    <div class="container" style="flex: 1;">
      <div class="stats">
        <div class="stat-card">
          <h2>259</h2>
          <p>Total Aset</p>
        </div>
        <div class="stat-card">
          <h2>5</h2>
          <p>Kondisi Kritis</p>
        </div>
        <div class="stat-card">
          <h2>247</h2>
          <p>Siap Digunakan</p>
        </div>
      </div>

      <h3 style="margin-top: 10px;">Tabel Inventaris Aktif</h3>
      <table>
        <thead>
          <tr>
            <th>No</th>
            <th>Nama Barang</th>
            <th>Kode Barang</th>
            <th>Jumlah</th>
            <th>Kondisi</th>
            <th>Lokasi</th>
            <th>Tanggal Input</th>
            <th>Petugas Input</th>
          </tr>
        </thead>
        <tbody id="data-inventaris">
          <!-- Data akan diisi secara dinamis oleh JavaScript -->
        </tbody>
      </table>

      <div class="footer-buttons">
        <button class="btn-green" id="btn-tambah">Tambah Item Baru</button>
        <button class="btn-gray" id="btn-update">Update</button>
        <button class="btn-red" id="btn-delete">Delete</button>
      </div>
    </div>
  </div>

  <div class="container" style="margin-top: 40px;">
    <div class="logo">
      <i class="fa-solid fa-gamepad"></i>
      <h1>STRIKE FORGE</h1>
    </div>

    <div class="search-bar" style="margin-top: 15px; width: 250px;">
      <input type="text" placeholder="Cari ID, atau Nama">
      <i class="fa-solid fa-magnifying-glass"></i>
    </div>

    <!-- Slider Gambar -->
    <div class="slider-container">
      <div class="slider">
        <div class="slide">
          <img src="..\img\WhatsApp Image 2025-11-12 at 07.30.10.jpeg" alt="AK-47">
        </div>
        <div class="slide">
          <img src="..\img\WhatsApp Image 2025-11-12 at 07.21.50.jpeg" alt="Thompson">
        </div>
        <div class="slide">
          <img src="..\img\pidyol.jpeg" alt="Revolver">
        </div>
        <div class="slide">
          <img src="..\img\WhatsApp Image 2025-11-12 at 07.30.47.jpeg" alt="FAMAS">
        </div>
        <div class="slide">
          <img src="..\img\WhatsApp Image 2025-11-12 at 07.22.49.jpeg" alt="M16">
        </div>
        <div class="slide">
          <img src="..\img\WhatsApp Image 2025-11-12 at 07.22.58.jpeg" alt="M4A1"> <!-- Placeholder, ganti dengan gambar asli -->
        </div>
      </div>
      <button class="prev" onclick="changeSlide(-1)">&#10094;</button>
      <button class="next" onclick="changeSlide(1)">&#10095;</button>
    </div>
  </div>

<style>
    body {
  font-family: 'Poppins', sans-serif;
  background-color: #1a1a1a;
  color: #fff;
  margin: 0;
  padding: 0;
}

.container {
  width: 90%;
  margin: 20px auto;
  background-color: #2b2b2b;
  border-radius: 15px;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
  padding: 20px;
}

.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 2px solid #3f3f3f;
  padding-bottom: 10px;
}

.header h1 {
  font-size: 20px;
  font-weight: 700;
  color: #eaeaea;
}

.logo {
  display: flex;
  align-items: center;
  gap: 10px;
}

.logo img {
  width: 30px;
}

.search-bar {
  display: flex;
  align-items: center;
  background-color: #3b3b3b;
  border-radius: 25px;
  padding: 5px 15px;
  width: 250px;
}

.search-bar input {
  background: none;
  border: none;
  color: white;
  outline: none;
  flex: 1;
}

.search-bar i {
  color: #aaa;
}

.sidebar {
  width: 220px;
  background-color: #242424;
  border-radius: 15px;
  padding: 20px;
  height: 100%;
}

.sidebar button, .sidebar a {
  display: block;
  width: 100%;
  text-align: left;
  background: none;
  border: none;
  color: #ccc;
  font-size: 14px;
  padding: 10px 0;
  cursor: pointer;
  transition: all 0.3s;
}

.sidebar button:hover,
.sidebar a:hover {
  color: #00ff00;
}

.stats {
  display: flex;
  justify-content: space-around;
  margin: 20px 0;
}

.stat-card {
  background-color: #3a3a3a;
  padding: 15px 25px;
  border-radius: 12px;
  text-align: center;
  flex: 1;
  margin: 5px;
}

.stat-card h2 {
  margin: 0;
  font-size: 24px;
  color: #00ff88;
}

.stat-card p {
  margin: 5px 0 0;
  font-size: 13px;
  color: #ccc;
}

table {
  width: 100%;
  border-collapse: collapse;
  background-color: #2e2e2e;
  border-radius: 10px;
  overflow: hidden;
}

table thead {
  background-color: #383838;
}

table th, table td {
  padding: 12px 10px;
  text-align: left;
  color: #ddd;
}

table tr:nth-child(even) {
  background-color: #333;
}

.badge {
  padding: 5px 10px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 13px;
}

.badge.baik {
  background-color: #00c853;
}

.badge.rusak {
  background-color: #e53935;
}

.badge.hilang {
  background-color: #fbc02d;
}

.badge.siap-tempur {
  background-color: #00e676;
}

button, .btn {
  padding: 8px 16px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  transition: 0.3s;
}

.btn-green {
  background-color: #00ff88;
  color: #000;
}

.btn-green:hover {
  background-color: #00cc6a;
}

.btn-gray {
  background-color: #444;
  color: white;
}

.btn-gray:hover {
  background-color: #555;
}

.btn-red {
  background-color: #e53935;
  color: white;
}

.btn-red:hover {
  background-color: #c62828;
}

.footer-buttons {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 25px;
}

/* Slider Styles */
.slider-container {
  position: relative;
  max-width: 600px;
  margin: 20px auto;
  overflow: hidden;
  border-radius: 10px;
}

.slider {
  display: flex;
  transition: transform 0.5s ease;
}

.slide {
  min-width: 100%;
  box-sizing: border-box;
}

.slide img {
  width: 100%;
  height: auto;
  border-radius: 10px;
}

.prev, .next {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background-color: rgba(0, 0, 0, 0.5);
  color: white;
  border: none;
  padding: 10px;
  cursor: pointer;
  font-size: 18px;
  border-radius: 50%;
  z-index: 100;
}

.prev {
  left: 10px;
}

.next {
  right: 10px;
}

.prev:hover, .next:hover {
  background-color: rgba(0, 0, 0, 0.8);
}
</style>

<script>
let currentSlide = 0;
const slides = document.querySelectorAll('.slide');
const totalSlides = slides.length;

function showSlide(index) {
  if (index >= totalSlides) {
    currentSlide = 0;
  } else if (index < 0) {
    currentSlide = totalSlides - 1;
  } else {
    currentSlide = index;
  }
  const slider = document.querySelector('.slider');
  slider.style.transform = `translateX(-${currentSlide * 100}%)`;
}

function changeSlide(direction) {
  showSlide(currentSlide + direction);
}

// Initialize
showSlide(currentSlide);
</script>

<script>
// ðŸ”¹ Variabel global untuk simpan data inventaris (untuk cari ID berdasarkan nama)
let inventarisData = [];
let userRole = '';

// ðŸ”¹ Fungsi Get User Role
function getUserRole() {
  fetch("../server/auth_check.php")
    .then(res => res.json())
    .then(data => {
      if (data.status === "success") {
        userRole = (data.level === 'admin') ? 'admin' : 'petugas';
      } else {
        userRole = 'petugas'; // Default jika error
      }
      setupUI();
    })
    .catch(err => {
      console.error("Gagal mendapatkan role:", err);
      userRole = 'petugas'; // Default
      setupUI();
    });
}

// ðŸ”¹ Fungsi Setup UI berdasarkan Role
function setupUI() {
  const btnDashboard = document.getElementById("btn-dashboard");
  const btnUpdate = document.getElementById("btn-update");
  const btnDelete = document.getElementById("btn-delete");

  if (userRole === 'admin') {
    btnDashboard.addEventListener("click", () => window.location.href = "dashboard_admin.html");
  } else {
    btnDashboard.addEventListener("click", () => window.location.href = "dashboard_petugas.html");
    btnUpdate.style.display = "none";
    btnDelete.style.display = "none";
  }
}

// ðŸ”¹ Fungsi Load Data Inventaris
function loadInventaris() {
  const tbody = document.getElementById("data-inventaris");
  tbody.innerHTML = "<tr><td colspan='8' style='text-align: center;'>Memuat data...</td></tr>";

  fetch("../server/barang_read.php")
    .then(res => res.json())
    .then(data => {
      tbody.innerHTML = "";
      inventarisData = data;  // Simpan data untuk fungsi delete

      if (data.status === "error") {
        tbody.innerHTML = `<tr><td colspan="8" style="text-align: center; color: red;">${data.message}</td></tr>`;
        return;
      }

      if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="8" style="text-align: center;">Belum ada data inventaris.</td></tr>`;
        return;
      }

      data.forEach((item, i) => {
        // Badge kondisi (sesuai CSS: baik, rusak, hilang)
        let badgeClass = "baik";
        if (item.kondisi.toLowerCase() === "rusak") badgeClass = "rusak";
        else if (item.kondisi.toLowerCase() === "hilang") badgeClass = "hilang";

        tbody.innerHTML += `
          <tr>
            <td>${i + 1}</td>
            <td>${item.nama_barang}</td>
            <td>${item.kode_barang}</td>
            <td>${item.jumlah}</td>
            <td><span class="badge ${badgeClass}">${item.kondisi}</span></td>
            <td>${item.lokasi}</td>
            <td>${item.tanggal_input}</td>
            <td>${item.nama_lengkap ?? '-'}</td>
          </tr>
        `;
      });
    })
    .catch(err => {
      tbody.innerHTML = `<tr><td colspan="8" style="text-align: center; color: red;">Gagal memuat data.</td></tr>`;
      console.error(err);
    });
}

// ðŸ”¹ Fungsi Tambah Item Baru (Popup untuk input semua field)
function tambahItem() {
  const namaBaru = prompt("Masukkan nama barang:");
  if (!namaBaru) return;

  const kodeBaru = prompt("Masukkan kode barang:");
  if (!kodeBaru) return;

  const jumlahBaru = prompt("Masukkan jumlah:");
  if (!jumlahBaru || isNaN(jumlahBaru)) {
    alert("Jumlah harus angka!");
    return;
  }

  const kondisiBaru = prompt("Masukkan kondisi:");
  if (!kondisiBaru) return;

  const lokasiBaru = prompt("Masukkan lokasi:");
  if (!lokasiBaru) return;

  fetch("../server/barang_create.php", {
    method: "POST",
    headers: {"Content-Type": "application/x-www-form-urlencoded"},
    body: `nama_barang=${encodeURIComponent(namaBaru)}&kode_barang=${encodeURIComponent(kodeBaru)}&jumlah=${encodeURIComponent(jumlahBaru)}&kondisi=${encodeURIComponent(kondisiBaru)}&lokasi=${encodeURIComponent(lokasiBaru)}`
  })
  .then(res => res.json())
  .then(result => {
    alert(result.message);
    if (result.status === "success") loadInventaris();
  });
}



// ðŸ”¹ Fungsi Update (Popup untuk update item)
function updateData() {
  const namaBarang = prompt("Masukkan nama barang yang ingin diupdate:");
  if (!namaBarang) return;

  // Cari item berdasarkan nama dari inventarisData
  const item = inventarisData.find(item => item.nama_barang.toLowerCase() === namaBarang.toLowerCase());
  if (!item) {
    alert("Barang dengan nama '" + namaBarang + "' tidak ditemukan.");
    return;
  }

  // Prompt untuk nilai baru
  const namaBaru = prompt("Masukkan nama barang baru (sekarang: " + item.nama_barang + "):", item.nama_barang);
  if (namaBaru === null) return;

  const kodeBaru = prompt("Masukkan kode barang baru (sekarang: " + item.kode_barang + "):", item.kode_barang);
  if (kodeBaru === null) return;

  const jumlahBaru = prompt("Masukkan jumlah baru (sekarang: " + item.jumlah + "):", item.jumlah);
  if (jumlahBaru === null || isNaN(jumlahBaru)) {
    alert("Jumlah harus angka!");
    return;
  }

  const kondisiBaru = prompt("Masukkan kondisi baru (sekarang: " + item.kondisi + "):", item.kondisi);
  if (kondisiBaru === null) return;

  const lokasiBaru = prompt("Masukkan lokasi baru (sekarang: " + item.lokasi + "):", item.lokasi);
  if (lokasiBaru === null) return;

  // Kirim ke server
  fetch("../server/barang_update.php", {
    method: "POST",
    headers: {"Content-Type": "application/x-www-form-urlencoded"},
    body: `id_barang=${item.id_barang}&nama_barang=${encodeURIComponent(namaBaru)}&kode_barang=${encodeURIComponent(kodeBaru)}&jumlah=${encodeURIComponent(jumlahBaru)}&kondisi=${encodeURIComponent(kondisiBaru)}&lokasi=${encodeURIComponent(lokasiBaru)}`
  })
  .then(res => res.json())
  .then(result => {
    alert(result.message);
    if (result.status === "success") loadInventaris();
  })
  .catch(err => {
    alert("Gagal mengupdate data.");
    console.error(err);
  });
}

// ðŸ”¹ Fungsi Delete (Prompt nama barang, cari ID dari data yang dimuat)
function deleteItem() {
  const namaBarang = prompt("Masukkan nama barang yang ingin dihapus:");
  if (!namaBarang) return;

  // Cari ID berdasarkan nama dari inventarisData
  const item = inventarisData.find(item => item.nama_barang.toLowerCase() === namaBarang.toLowerCase());
  if (!item) {
    alert("Barang dengan nama '" + namaBarang + "' tidak ditemukan.");
    return;
  }

  if (!confirm("Yakin hapus barang '" + namaBarang + "'?")) return;

  fetch("../server/barang_delete.php", {
    method: "POST",
    headers: {"Content-Type": "application/x-www-form-urlencoded"},
    body: `id_barang=${item.id_barang}`
  })
  .then(res => res.json())
  .then(result => {
    alert(result.message);
    if (result.status === "success") loadInventaris();
  });
}

// ðŸ”¹ Fungsi Logout
function logout() {
  window.location.href = "../server/logout.php";
}

// ðŸ”¹ Event Listener untuk Tombol Footer
document.getElementById("btn-tambah").addEventListener("click", tambahItem);
document.getElementById("btn-update").addEventListener("click", updateData);
document.getElementById("btn-delete").addEventListener("click", deleteItem);
document.getElementById("btn-logout").addEventListener("click", logout);

// ðŸ”¹ Mulai: Load data saat DOM ready
document.addEventListener("DOMContentLoaded", () => {
  getUserRole();
  loadInventaris();
});
</script>

</body>
</html>
